{"version":3,"file":"crispy-formset-modal.min.js","sources":["../../../../js/src/utils.js","../../../../js/src/formset.js","../../../../js/src/modal.js","../../../../js/src/modal-form.js","../../../../js/src/formset-modal.js","../../../../js/src/index.js"],"sourcesContent":["let gettext = window.gettext;\nconst _has = Object.prototype.hasOwnProperty;\n/**\n * Checks if the object has the property passed as argument\n */\nexport function has(object, key) {\n  return _has.call(object, key);\n}\n\nexport function uuidv4() {\n  function randomHex() {\n    return Math.floor((1 + Math.random()) * 0x10000)\n      .toString(16)\n      .substring(1);\n  }\n\n  const part1 = randomHex() + randomHex();\n  const part2 = randomHex();\n  const part3 = ((parseInt(randomHex(), 16) & 0x0fff) | 0x4000).toString(16);\n  const part4 = ((parseInt(randomHex(), 16) & 0x3fff) | 0x8000).toString(16);\n  const part5 = randomHex() + randomHex() + randomHex();\n\n  return `${part1}-${part2}-${part3}-${part4}-${part5}`;\n}\n\nexport function getTextValue(el) {\n  let type = el.tagName.toLowerCase();\n  let textValue = \"\";\n  if (type === \"select\") {\n    textValue = el.options[el.selectedIndex].innerText;\n  } else {\n    if (has(el, \"inputmask\")) {\n      textValue = el.inputmask.undoValue;\n    } else {\n      if (el.getAttribute(\"type\") == \"date\") {\n        if (el.value) {\n          textValue = new Date(...el.value.split(\"-\")).toLocaleDateString();\n        }\n      } else {\n        if (el.getAttribute(\"type\") == \"checkbox\") {\n          textValue = el.checked ? \"on\" : \"off\";\n        } else {\n          textValue = el.value;\n        }\n      }\n    }\n  }\n  return textValue;\n}\n\nexport function getNumberValue(value) {\n  return Number(value);\n}\n\nexport function executeAllCalculatedFields() {\n  if (window.hasOwnProperty(\"calculatedFields\")) {\n    calculatedFields.forEach(function (obj) {\n      obj.executeAll();\n    });\n  }\n}\n\nexport function hookCalculatedFields() {\n  if (window.hasOwnProperty(\"calculatedFields\")) {\n    window.calculatedFields.forEach(function (obj) {\n      let el = obj.field;\n      let id = el.getAttribute(\"id\");\n      let column = document.querySelector(\"td[data-source='\" + id + \"']\");\n      if (column) {\n        if (!el.hasAttribute(\"data-event\")) {\n          el.addEventListener(\"oncalculate\", function () {\n            let content = getTextValue(el);\n            // The column element is refetched since the table is recreated on each event\n            let _column = document.querySelector(\n              \"td[data-source='\" + id + \"']\"\n            );\n            if (_column) {\n              _column.innerText = content;\n            }\n          });\n          el.setAttribute(\"data-event\", true);\n        }\n      }\n    });\n  }\n}\n\nexport function removeChildren(a) {\n  while (a.hasChildNodes()) {\n    a.removeChild(a.lastChild);\n  }\n}\n\nexport function injectStyles() {\n  const css = `\n    .cfm-selection-border {\n        position: absolute;\n        top: 0px;\n        bottom: 0px;\n        left: 0px;\n        width: 0.150rem;\n        background-color: rgb(220 53 69 / 1);\n    }\n    .cfm-modal-backdrop {\n        position: fixed;\n        inset: 0px;\n        z-index: 100;\n        background-color: rgb(31 41 55 / 1);\n        opacity: 0;\n        transition-property: opacity;\n        transition-duration: 300ms;\n        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n    }\n    .cfm-opacity-50 {\n        opacity: 0.5;\n    }\n    .cfm-opacity-100 {\n        opacity: 1;\n    }\n    .cfm-tr.selected{\n      background-color: rgba(0, 0, 0, 0.08) !important;\n    }\n    .cfm .modal-body {\n      max-height: calc(100vh - 150px);\n      overflow-x: auto;\n    }\n    `;\n  const style = document.createElement(\"style\");\n  style.innerHTML = css;\n  document.head.appendChild(style);\n}\n\nexport function getModalInstance(id, instances) {\n  if (instances.some((modalInstance) => modalInstance.id === id)) {\n    return instances.find((modalInstance) => modalInstance.id === id);\n  }\n  return false;\n}\n\nexport function ready(fn) {\n  if (document.readyState !== \"loading\") {\n    fn();\n  } else {\n    document.addEventListener(\"DOMContentLoaded\", fn);\n  }\n}\n\n\nif (!window.django || !window.django.jsi18n_initialized) {\n  gettext = (msg) => msg;\n}\n\nexport { gettext };\n","/**\n* Django formset helper\n* Copyright (c) 2013, Ionata Web Solutions\n* All rights reserved.\n*\n* Redistribution and use in source and binary forms, with or without\n* modification, are permitted provided that the following conditions are met:\n*\n* Redistributions of source code must retain the above copyright notice, this\n* list of conditions and the following disclaimer.\n*\n* Redistributions in binary form must reproduce the above copyright notice, this\n* list of conditions and the following disclaimer in the documentation and/or\n* other materials provided with the distribution.\n*\n* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\n* ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n* WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n* DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n* FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n* DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n* SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n* CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n* OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\nimport { uuidv4 } from \"./utils\";\nimport $ from \"jquery\";\n\nexport const pluginName = 'formset';\n\n\nclass Formset {\n    constructor(el, options) {\n        var _this = this;\n\n        //Defaults:\n        this.opts = $.extend({}, Formset.defaults, options);\n\n        this.$formset = $(el);\n        this.$formset.attr(\"data-uuid\", uuidv4());\n        this.$emptyForm = this.$formset.find(this.opts.emptyForm);\n        this.$body = this.$formset.find(this.opts.body);\n        this.$add = this.$formset.find(this.opts.add);\n\n        this.formsetPrefix = $(el).data('formset-prefix');\n\n        // Bind to the `Add form` button\n        this.addForm = $.proxy(this, 'addForm');\n        this.$add.click(this.addForm);\n\n        // Bind receiver to `formAdded` and `formDeleted` events\n        this.$formset.on('formAdded formDeleted', this.opts.form, $.proxy(this, 'checkMaxForms'));\n\n        // Set up the existing forms\n        this.$forms().each(function (i, form) {\n            var $form = $(form);\n            _this.bindForm($(this), i);\n        });\n\n        // Store a reference to this in the formset element\n        this.$formset.data(pluginName, this);\n\n        var extras = ['animateForms'];\n        $.each(extras, function (i, extra) {\n            if ((extra in _this.opts) && (_this.opts[extra])) {\n                _this[extra]();\n            }\n        });\n    }\n    static getOrCreate(el, options) {\n        var rev = $(el).data(pluginName);\n        if (!rev) {\n            rev = new Formset(el, options);\n        }\n\n        return rev;\n    }\n    addForm() {\n        // Don't proceed if the number of maximum forms has been reached\n        if (this.hasMaxForms()) {\n            throw new Error(\"MAX_NUM_FORMS reached\");\n        }\n\n        var newIndex = this.totalFormCount();\n        this.$managementForm('TOTAL_FORMS').val(newIndex + 1);\n\n        var newFormHtml = this.$emptyForm.html()\n            .replace(new RegExp('__prefix__', 'g'), newIndex)\n            .replace(new RegExp('<\\\\\\\\/script>', 'g'), '</script>');\n\n        var $newFormFragment = $($.parseHTML(newFormHtml, this.$body.document, true));\n        this.$body.append($newFormFragment);\n\n        var $newForm = $newFormFragment.filter(this.opts.form);\n        this.bindForm($newForm, newIndex);\n        if (this.opts.newFormCallback) {\n            this.opts.newFormCallback($newForm);\n        }\n        return $newForm;\n    }\n    /**\n    * Attach any events needed to a new form\n    */\n    bindForm($form, index) {\n        var prefix = this.formsetPrefix + '-' + index;\n        $form.data(pluginName + '__formPrefix', prefix);\n\n        var $delete = $form.find('[name=' + prefix + '-DELETE]');\n\n        // Trigger `formAdded` / `formDeleted` events when delete checkbox value changes\n        $delete.change(function (event) {\n            if ($delete.is(':checked')) {\n                $form.attr('data-formset-form-deleted', '');\n                // Remove required property and pattern attribute to allow submit, back it up to data field\n                $form.find(':required').data(pluginName + '-required-field', true).prop('required', false);\n                $form.find('input[pattern]').each(function () {\n                    var pattern = $(this).attr('pattern');\n                    $(this).data(pluginName + '-field-pattern', pattern).removeAttr('pattern');\n                });\n                $form.trigger('formDeleted');\n            } else {\n                $form.removeAttr('data-formset-form-deleted');\n                // Restore required property and pattern attributes from data field\n                $form.find('*').filter(function () {\n                    return $(this).data(pluginName + '-required-field') === true;\n                }).prop('required', true);\n                $form.find('input').each(function () {\n                    var pattern = $(this).data(pluginName + '-field-pattern');\n                    if (pattern) {\n                        $(this).attr('pattern', pattern);\n                    }\n                });\n                $form.trigger('formAdded');\n            }\n        }).trigger('change');\n\n        var $deleteButton = $form.find(this.opts.deleteButton);\n\n        $deleteButton.bind('click', function () {\n            $delete.attr('checked', true).change();\n        });\n    }\n    $forms() {\n        return this.$body.find(this.opts.form);\n    }\n    $managementForm(name) {\n        return this.$formset.find('[name=' + this.formsetPrefix + '-' + name + ']');\n    }\n    totalFormCount() {\n        return this.$forms().length;\n    }\n    deletedFormCount() {\n        return this.$forms().filter('[data-formset-form-deleted]').length;\n    }\n    clear() {\n        this.$forms().each(function (key, row) {\n            $(row).find(':input').not(':button, :submit, :reset, :hidden, :checkbox, :radio').val('');\n        });\n    }\n    deleteAll() {\n        this.$forms().each(function (key, row) {\n            $(row).find('[deletecheckbox]').prop(\"checked\", true).change();\n        });\n    }\n    activeFormCount() {\n        return this.totalFormCount() - this.deletedFormCount();\n    }\n    openRownum() {\n        var rownum = this.$formset.find('tr.row-open').attr('data-rownum');\n        return typeof rownum != undefined ? parseInt(rownum) : 0;\n    }\n    hasMaxForms() {\n        var maxForms = parseInt(this.$managementForm('MAX_NUM_FORMS').val(), 10) || 1000;\n        return this.activeFormCount() >= maxForms;\n    }\n    checkMaxForms() {\n        if (this.hasMaxForms()) {\n            this.$formset.addClass(this.opts.hasMaxFormsClass);\n            this.$add.attr('disabled', 'disabled');\n        } else {\n            this.$formset.removeClass(this.opts.hasMaxFormsClass);\n            this.$add.removeAttr('disabled');\n        }\n    }\n    animateForms() {\n        this.$formset.on('formAdded', this.opts.form, function () {\n            var $form = $(this);\n            $form.slideUp(0);\n            $form.slideDown();\n        }).on('formDeleted', this.opts.form, function () {\n            var $form = $(this);\n            $form.slideUp();\n        });\n        this.$forms().filter('[data-formset-form-deleted]').slideUp(0);\n    }\n}\n\nFormset.defaults = {\n    form: '[data-formset-form]',\n    emptyForm: 'script[type=form-template][data-formset-empty-form]',\n    body: '[data-formset-body]',\n    add: '[data-formset-add]',\n    deleteButton: '[data-formset-delete-button]',\n    hasMaxFormsClass: 'has-max-forms',\n    animateForms: false,\n    newFormCallback: false\n};\n\nexport default Formset;\n","import { uuidv4 } from \"./utils\";\n\nconst bootstrap4SizeClasses = {\n  sm: \"modal-sm\",\n  md: \"modal-md\",\n  lg: \"modal-lg\",\n  xl: \"modal-xl\",\n};\n\nconst bootstrap5SizeClasses = bootstrap4SizeClasses;\n\nconst templatePacks = {\n  bootstrap4: { sizes: bootstrap4SizeClasses },\n  bootstrap5: { sizes: bootstrap5SizeClasses },\n};\n\nconst modalDefault = {\n  placement: \"center\",\n  size: \"md\",\n  backdropClasses: \"cfm-modal-backdrop\",\n  templatePack: null,\n  onHide: () => {},\n  onShow: () => {},\n  onToggle: () => {},\n};\n\nclass Modal {\n  constructor(targetEl = null, options = {}) {\n    this._targetEl = targetEl;\n    this._parentEl = targetEl.parentElement;\n    this._options = {\n      ...modalDefault,\n      ...options,\n    };\n    this._isHidden = true;\n    this._init();\n    this._addEventListeners();\n  }\n  _init() {\n    this._getPlacementClasses().map((c) => {\n      this._targetEl.classList.add(c);\n    });\n    this._clearSize();\n    this._getSizeClasses().map((c) => {\n      this._targetEl.firstElementChild.classList.add(c);\n    });\n  }\n  _createBackdrop(id) {\n    if (this._isHidden) {\n      const backdropEl = document.createElement(\"div\");\n      backdropEl.setAttribute(\"data-ref-id\", id);\n      backdropEl.setAttribute(\"modal-backdrop\", \"\");\n      backdropEl.classList.add(...this._options.backdropClasses.split(\" \"));\n      this._parentEl.append(backdropEl);\n      backdropEl.offsetWidth;\n      backdropEl.classList.add(\"cfm-opacity-50\");\n    }\n  }\n  _destroyBackdropEl() {\n    if (!this._isHidden) {\n      let id = this._targetEl.getAttribute(\"data-ref-id\");\n      document.querySelector(`[modal-backdrop][data-ref-id=\"${id}\"]`).remove();\n    }\n  }\n  _getPlacementClasses() {\n    switch (this._options.placement) {\n      // top\n      case \"top-left\":\n        return [\"justify-content-start\", \"align-items-start\"];\n      case \"top-center\":\n        return [\"justify-content-center\", \"align-items-start\"];\n      case \"top-right\":\n        return [\"justify-content-end\", \"align-items-start\"];\n\n      // center\n      case \"center-left\":\n        return [\"justify-content-start\", \"align-items-center\"];\n      case \"center\":\n        return [\"justify-content-center\", \"align-items-center\"];\n      case \"center-right\":\n        return [\"justify-content-end\", \"align-items-center\"];\n\n      // bottom\n      case \"bottom-left\":\n        return [\"justify-content-start\", \"align-items-end\"];\n      case \"bottom-center\":\n        return [\"justify-content-center\", \"align-items-end\"];\n      case \"bottom-right\":\n        return [\"justify-content-end\", \"align-items-end\"];\n\n      default:\n        return [\"justify-content-center\", \"align-items-center\"];\n    }\n  }\n  _getSizeClasses() {\n    return templatePacks[this._options.templatePack].sizes[\n      this._options.size\n    ].split(\" \");\n  }\n  _clearSize() {\n    const element = this._targetEl.firstElementChild;\n    const obj = templatePacks[this._options.templatePack].sizes;\n    for (const key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        element.classList.remove(obj[key]);\n      }\n    }\n  }\n  _addEventListeners() {\n    let that = this;\n    this._targetEl.addEventListener(\"keyup\", function (e) {\n      if (e.key === \"Escape\") {\n        that.hide();\n      }\n    });\n  }\n  toggle() {\n    if (this._isHidden) {\n      this.show();\n    } else {\n      this.hide();\n    }\n\n    // callback function\n    this._options.onToggle(this);\n  }\n  show() {\n    const id = uuidv4();\n    this._targetEl.classList.add(\"d-flex\");\n    this._targetEl.classList.remove(\"d-none\");\n    this._targetEl.setAttribute(\"aria-modal\", \"true\");\n    this._targetEl.setAttribute(\"role\", \"dialog\");\n    this._targetEl.removeAttribute(\"aria-hidden\");\n    this._targetEl.setAttribute(\"data-ref-id\", id);\n    this._createBackdrop(id);\n    this._isHidden = false;\n\n    document.body.classList.add(\"modal-open\");\n\n    // callback function\n    this._options.onShow(this);\n\n    let firstEl = this._targetEl.querySelector(\n      'select, input:not([type=\"hidden\"]'\n    );\n    if (firstEl) {\n      firstEl.setAttribute(\"tabindex\", \"0\");\n      firstEl.focus();\n    }\n    this._targetEl.offsetWidth;\n    this._targetEl.classList.add(\"cfm-opacity-100\");\n  }\n  hide() {\n    this._targetEl.classList.add(\"d-none\");\n    this._targetEl.classList.remove(\"d-flex\");\n    this._targetEl.setAttribute(\"aria-hidden\", \"true\");\n    this._targetEl.removeAttribute(\"aria-modal\");\n    this._targetEl.removeAttribute(\"role\");\n    this._destroyBackdropEl();\n    this._isHidden = true;\n\n    document.body.classList.remove(\"modal-open\");\n\n    // callback function\n    this._options.onHide(this);\n  }\n}\n\nexport default Modal;\n","import Modal from \"./modal\";\nimport { gettext } from \"./utils\";\n\nconst modalFormOptions = {\n  parent: null,\n  modalId: null,\n  onKeyUp: function () {},\n  onClose: function () {},\n  onOpen: function () {},\n};\n\nclass ModalForm {\n  constructor(targetEl, options = {}) {\n    this.targetEl = targetEl;\n    this._options = {\n      ...modalFormOptions,\n      ...options,\n    };\n    this.modalId = this._options.modalId;\n    this._modalEl = null;\n    this._modalTitleEl = null;\n    this._modalDeleteBt = null;\n    this.modalInstance = false;\n    this.rownum = null;\n    this._init();\n    this._addEvents();\n  }\n  _init() {\n    this._modalEl = document.getElementById(this.modalId);\n    this._modalTitleEl = this._modalEl.querySelector(\".modal-title\");\n    this._modalDeleteBt = this._modalEl.querySelector(\".formset-delete\");\n    this._createModal();\n  }\n  _addEvents() {\n    let that = this;\n    this._modalEl\n      .querySelectorAll('[data-formset-modal-toggle=\"' + this.modalId + '\"]')\n      .forEach(function (el) {\n        el.addEventListener(\"click\", function () {\n          that.close();\n        });\n      });\n  }\n  hasFieldError(fieldId) {\n    let fieldWrapper = this.targetEl.querySelector(`#div_${fieldId}`);\n    let hasError = false;\n    let errorText = \"\";\n    fieldWrapper.querySelectorAll(\".field-error\").forEach(function (el) {\n      hasError = true;\n      errorText = el.innerText;\n    });\n    return { error: hasError, text: errorText };\n  }\n  hasNonFieldError() {\n    return this.targetEl.querySelector(\".non-field-errors\") != null;\n  }\n  _hiddeDefaultDeleteBt(el) {\n    let parentEl = el.parentNode;\n    parentEl.classList.add(\"d-none\");\n  }\n  _createModal() {\n    let that = this;\n    if (!this.modalInstance) {\n      let deleteBt = this.targetEl.querySelector(\".formset-delete\");\n      let modal = new Modal(this._modalEl, {\n        placement: that._options.placement,\n        size: that._options.size,\n        templatePack: that._options.templatePack,\n        onHide: function (modal) {\n          that._onModalClose(modal);\n        },\n        onShow: function (modal) {\n          that._onModalShow(modal);\n        },\n      });\n      modal._targetEl.addEventListener(\"keyup\", function (e) {\n        that._options.onKeyUp(e, that);\n      });\n      this.modalInstance = modal;\n      this._hiddeDefaultDeleteBt(deleteBt);\n    }\n  }\n  _onModalShow(modal) {\n    this._options.onOpen(this);\n    let openRowBt = this._options.parent.targetEl.querySelector(\n      \".btn-open-row[data-formset-modal-toggle='\" + this.modalId + \"']\"\n    );\n    let tr = openRowBt.closest(\"tr\");\n    this._modalTitleEl.innerText = gettext(\"Editing row #\") + this.rownum;\n    tr.classList.add(\"row-open\");\n  }\n  _onModalClose(modal) {\n    this._options.onClose(this);\n    let openRowBt = this._options.parent.targetEl.querySelector(\n      \".btn-open-row[data-formset-modal-toggle='\" + this.modalId + \"']\"\n    );\n    if (openRowBt) {\n      let tr = openRowBt.closest(\"tr\");\n      tr.classList.remove(\"row-open\");\n    }\n  }\n  isDeleted() {\n    return this.targetEl.hasAttribute(\"data-formset-form-deleted\");\n  }\n  isSelected() {\n    return this.targetEl.hasAttribute(\"data-formset-form-selected\");\n  }\n  open() {\n    this.modalInstance.show();\n  }\n  close() {\n    this.modalInstance.hide();\n  }\n}\n\nexport default ModalForm;\n","import $ from \"jquery\";\nimport ModalForm from \"./modal-form\";\nimport {\n  executeAllCalculatedFields,\n  getNumberValue,\n  getTextValue,\n  gettext,\n  hookCalculatedFields,\n  removeChildren,\n  uuidv4\n} from \"./utils\";\n\nconst variant = {\n  tabular: \"tabular\",\n  stacked: \"stacked\",\n  modal: \"modal\",\n};\n\nconst pencilSvg = `\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" fill=\"currentColor\" class=\"bi bi-pencil\" viewBox=\"0 0 16 16\">\n    <path d=\"M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z\"/>\n</svg>\n`;\n\nconst formsetOptions = {\n  checkboxClasses: \"checkbox\",\n  selectionMarkClasses: \"cfm-selection-border\",\n  tdClasses: \"cfm-td\",\n  trClasses: \"cfm-tr\",\n  editText: gettext(\"Edit\"),\n  pencilIcon: pencilSvg,\n};\n\nclass FormsetModal {\n  constructor(elementId) {\n    this._id = elementId;\n    this.targetEl = document.getElementById(this._id);\n    this.variant = variant.tabular;\n    this.$formset = null;\n    this._options = {\n      ...formsetOptions,\n    };\n    this._modalForms = [];\n    this._deleteBt = null;\n    this._table = null;\n    this._tbody = null;\n    this._tfoot = null;\n    this._init();\n    this._addEvents();\n  }\n  _init() {\n    this.variant = this._getVariant();\n    this.templatePack = this._getTemplatePack();\n    this.modalSize = this._getModalSize();\n    this.modalPlacement = this._getModalPlacement();\n    // Create Formset Helper Instance\n    this.$formset = $(`#${this._id}`);\n    this.$formset.formset({\n      animateForms: true,\n    });\n    if (this.variant === variant.modal || this.variant == variant.tabular) {\n      this._table = this.targetEl.querySelector(\"table\");\n      this._tbody = this._table.querySelector(\"tbody\");\n      this._tfoot = this._table.querySelector(\"tfoot\");\n      this._emptyState = this._tbody.innerHTML;\n    }\n    if (this.variant === variant.modal) {\n      this._deleteBt = this.targetEl.querySelector(\".delete-selected\");\n      this._checkInitials();\n      this._configureSelectAllToggler();\n      this._refresh();\n    }\n  }\n  _getVariant() {\n    return this.targetEl.getAttribute(\"data-formset-variant\");\n  }\n  _getTemplatePack(){\n    return this.targetEl.getAttribute(\"data-template-pack\");\n  }\n  _getModalSize(){\n    return this.targetEl.getAttribute(\"data-modal-size\");\n  }\n  _getModalPlacement(){\n    return this.targetEl.getAttribute(\"data-modal-placement\");\n  }\n  _getModalFormInstanceByRownum(rownum) {\n    let instance = false;\n    this._modalForms.forEach(function (obj) {\n      if (obj.rownum === rownum && !obj.isDeleted()) {\n        instance = obj;\n      }\n    });\n    return instance;\n  }\n  _addEvents() {\n    let that = this;\n    this.$formset.on(\"formAdded\", function (e) {\n      that._onFormsetAdded(e);\n    });\n    this.$formset.on(\"formDeleted\", function (e) {\n      that._onFormsetDeleted(e);\n    });\n  }\n  /**\n   * Check if the page loaded form from the server to configure them.\n   */\n  _checkInitials() {\n    let that = this;\n    let modals = [];\n    this.targetEl\n      .querySelectorAll(\"[data-formset-modal-toggle]\")\n      .forEach(function (el) {\n        let targetEl = el.closest(\"[data-formset-form]\");\n        let modalId = el.getAttribute(\"data-formset-modal-toggle\");\n        if (!modals.includes(modalId)) {\n          that._newModalForm(targetEl, modalId);\n        }\n        modals.push(modalId);\n      });\n  }\n  _newModalForm(targetEl, modalId) {\n    let that = this;\n    let options = {\n      parent: that,\n      modalId: modalId,\n      size: that.modalSize,\n      placement: that.modalPlacement,\n      templatePack: that.templatePack,\n      onKeyUp: function (e, modalForm) {\n        that._onModalFormKeyUp(e, modalForm);\n      },\n      onOpen: function (modalForm) {\n        that._onModalFormOpen(modalForm);\n      },\n      onClose: function (modalForm) {\n        that._onModalFormClose(modalForm);\n      },\n    };\n    let modalForm = new ModalForm(targetEl, options);\n    that._modalForms.push(modalForm);\n    return modalForm;\n  }\n  _onFormsetAdded(e) {\n    if (this.variant === variant.modal) {\n      let id = uuidv4();\n      $(this.targetEl).find(\"#__dialog_id__\").attr(\"id\", id);\n      $(this.targetEl)\n        .find('[data-formset-modal-toggle=\"__dialog_id__\"]')\n        .attr(\"data-formset-modal-toggle\", id);\n      let modalForm = this._newModalForm(e.target, id);\n      modalForm.open();\n    }\n    if (window.hasOwnProperty(\"calculatedFields\")) {\n      window.resetCalculatedFields();\n      hookCalculatedFields();\n    }\n  }\n  _onFormsetDeleted() {\n    if (this.variant == variant.modal) {\n      this._refresh();\n    }\n    executeAllCalculatedFields();\n  }\n  _onModalFormKeyUp(e, modalForm) {\n    if (e.ctrlKey && (e.keyCode === 38 || e.keyCode === 40)) {\n      e.preventDefault();\n      let openRownum = modalForm.rownum;\n      let $formset = this.$formset.formset(\"getOrCreate\");\n      let activeFormCount = $formset.activeFormCount();\n      if (e.keyCode == 38) {\n        // Up\n        if (openRownum > 1) {\n          modalForm.close();\n          let previewsModalForm = this._getModalFormInstanceByRownum(\n            openRownum - 1\n          );\n          previewsModalForm.open();\n        }\n      }\n\n      if (e.keyCode === 40) {\n        // Down\n        if (openRownum < activeFormCount) {\n          modalForm.close();\n          let nextsModalForm = this._getModalFormInstanceByRownum(\n            openRownum + 1\n          );\n          nextsModalForm.open();\n        }\n        if (openRownum == activeFormCount) {\n          modalForm.close();\n          $formset.addForm();\n        }\n      }\n    }\n  }\n  _onModalFormOpen(modalForm) {\n    this._refresh();\n  }\n  _onModalFormClose(modalForm) {\n    this._refresh();\n  }\n  _configureSelectAllToggler() {\n    let that = this;\n    let table = this._table;\n    let toggler = this.targetEl.querySelector(\".select-all\");\n    let deleteBt = this.targetEl.querySelector(\".delete-selected\");\n\n    toggler.addEventListener(\"change\", function (e) {\n      let checked = toggler.checked;\n      let checkBoxes = table.querySelectorAll(\".select-row\");\n      checkBoxes.forEach(function (checkbox) {\n        let tr = checkbox.closest(\"tr\");\n        let td = checkbox.closest(\"td\");\n        let btnOpenRow = tr.querySelector(\"[data-formset-modal-toggle]\");\n        let modalId = btnOpenRow.getAttribute(\"data-formset-modal-toggle\");\n        let modalEl = document.getElementById(modalId);\n        let formsetFormEl = modalEl.closest(\"[data-formset-form]\");\n        checkbox.checked = checked;\n        that._checker(tr, td, formsetFormEl, checkbox);\n      });\n    });\n\n    deleteBt.addEventListener(\"click\", function (e) {\n      let formset = that.targetEl;\n      let selectedForms = formset.querySelectorAll(\n        \"[data-formset-form-selected]\"\n      );\n      selectedForms.forEach(function (selectedForm) {\n        let deleteCheckbox = selectedForm.querySelector(\".formset-delete\");\n        deleteCheckbox.checked = true;\n        deleteCheckbox.dispatchEvent(new Event(\"change\"));\n      });\n    });\n  }\n  _checkSelectAllState() {\n    let table = this._table;\n    let formset = this.targetEl;\n    let deleteBt = formset.querySelector(\".delete-selected\");\n    let showDeleteBt = false;\n    let selectAllToggler = table.querySelector(\".select-all\");\n    let recordCount = table.querySelectorAll(\"tbody tr\").length;\n    let selected = table.querySelectorAll(\"tr.selected\").length;\n\n    if (selected === recordCount && recordCount > 0) {\n      selectAllToggler.checked = true;\n      selectAllToggler.indeterminate = false;\n      showDeleteBt = true;\n    } else {\n      if (selected != recordCount && selected > 0) {\n        selectAllToggler.indeterminate = true;\n        selectAllToggler.checked = false;\n        showDeleteBt = true;\n      }\n      if (selected === 0) {\n        selectAllToggler.checked = false;\n        selectAllToggler.indeterminate = false;\n        showDeleteBt = false;\n      }\n    }\n\n    if (showDeleteBt) {\n      deleteBt.classList.remove(\"d-none\");\n      deleteBt.classList.add(\"d-inline-flex\");\n    } else {\n      deleteBt.classList.remove(\"d-inline-flex\");\n      deleteBt.classList.add(\"d-none\");\n    }\n  }\n  _checker(tr, td, formsetFormEl, checkbox) {\n    // remove previous divSel if exists.\n    let prevDivSel = td.querySelector(\".cfm-selection-border\");\n    if (prevDivSel) {\n      prevDivSel.remove();\n    }\n    if (checkbox.checked) {\n      let divSel = document.createElement(\"div\");\n      td.classList.add(\"position-relative\");\n      divSel.classList.add(...this._options.selectionMarkClasses.split(\" \"));\n      td.prepend(divSel);\n      formsetFormEl.setAttribute(\"data-formset-form-selected\", \"selected\");\n      tr.classList.add(\"selected\");\n    } else {\n      checkbox.classList.remove(\"position-relative\");\n      tr.classList.remove(\"selected\");\n      formsetFormEl.removeAttribute(\"data-formset-form-selected\");\n    }\n    this._checkSelectAllState();\n  }\n  _refresh() {\n    let that = this;\n    let fields = {};\n    let fieldNames = [];\n    let rows = [];\n\n    this._table.querySelectorAll(\"[data-field-name]\").forEach(function (el) {\n      fields[el.getAttribute(\"data-field-name\")] = {\n        type: el.getAttribute(\"data-field-type\"),\n        hasSummary: el.hasAttribute(\"data-field-summary\"),\n        summary: 0,\n      };\n    });\n\n    fieldNames = Object.keys(fields);\n\n    this._modalForms.forEach(function (modalForm) {\n      if (!modalForm.isDeleted()) {\n        let row = {};\n        modalForm.targetEl\n          .querySelectorAll(\"input, select\")\n          .forEach(function (el) {\n            let match = el.name.match(\n              /(?<form>\\w+)-(?<number>\\w+)-(?<name>\\w+)/\n            );\n            if (match) {\n              let name = match.groups.name;\n              if (fieldNames.includes(name)) {\n                let content = getTextValue(el);\n                row[name] = {\n                  value: content,\n                  sourceId: el.getAttribute(\"id\"),\n                };\n                row[\"modalForm\"] = modalForm;\n              }\n            }\n          });\n        rows.push(row);\n      }\n    });\n\n    // Remove all rows\n    removeChildren(this._tbody);\n\n    if (rows.length === 0) {\n      this._tbody.innerHTML = this._emptyState;\n    }\n\n    let rownum = 1;\n    rows.forEach(function (row) {\n      row.modalForm.rownum = rownum;\n      // Table row\n      let tr = document.createElement(\"tr\");\n      tr.classList.add(...that._options.trClasses.split(\" \"));\n      tr.setAttribute(\"data-rownum\", rownum);\n      // Highlight row if there are non field errors\n      if (row.modalForm.hasNonFieldError()) {\n        tr[\"style\"] = \"border: 1px solid #ff4545\";\n      }\n      // Selection column\n      let tdSel = document.createElement(\"td\");\n      let selCheckbox = document.createElement(\"input\");\n      selCheckbox.setAttribute(\"type\", \"checkbox\");\n      selCheckbox.classList.add(...that._options.checkboxClasses.split(\" \"));\n      selCheckbox.classList.add(\"select-row\");\n      tdSel.appendChild(selCheckbox);\n      //tdSel.classList.add('w-10');\n      //tdSel.classList.add('text-center', 'dark:bg-gray-700', 'dark:border-gray-600');\n      selCheckbox.addEventListener(\"change\", function (e) {\n        that._checker(tr, tdSel, row.modalForm.targetEl, e.target);\n      });\n      tr.appendChild(tdSel);\n      // Column for row number\n      let tdNumber = document.createElement(\"td\");\n      tdNumber.classList.add(...that._options.tdClasses.split(\" \"));\n      tdNumber.classList.add(\"w-10\");\n      tdNumber.classList.add(\"text-right\");\n      tdNumber.classList.add(\"cursor-pointer\");\n      tdNumber.innerText = rownum;\n      tdNumber.addEventListener(\"click\", function () {\n        row.modalForm.open();\n      });\n      tr.appendChild(tdNumber);\n      // Mirror columns\n      fieldNames.forEach(function (field) {\n        let td = document.createElement(\"td\");\n        let hasError = row.modalForm.hasFieldError(row[field].sourceId);\n        td.classList.add(...that._options.tdClasses.split(\" \"));\n        if (hasError.error) {\n          td[\"style\"] = \"border: 1px solid #ff4545\";\n          td[\"title\"] = hasError.text;\n        }\n        if (fields[field].type === \"bool\") {\n          checked = row[field].value === \"on\" ? \"checked\" : \"\";\n          td.innerHTML = `<input type=\"checkbox\" class=\"${that._options.checkboxClasses}\" ${checked} disabled></input>`;\n        } else {\n          td.innerText = row[field].value;\n        }\n        if (fields[field].type === \"numeric\") {\n          td.classList.add(\"text-right\");\n          if (fields[field].hasSummary) {\n            fields[field].summary =\n              fields[field].summary + getNumberValue(row[field].value);\n          }\n        }\n        if (fields[field].type === \"bool\" || fields[field].type == \"date\") {\n          td.classList.add(\"text-center\");\n        }\n        td.setAttribute(\"data-source\", row[field].sourceId);\n        tr.appendChild(td);\n      });\n      // Column for edit button\n      let tdEdit = document.createElement(\"td\");\n      tdEdit.classList.add(...that._options.tdClasses.split(\" \"));\n      tdEdit.classList.add(\"w-16\");\n      tdEdit.classList.add(\"text-center\");\n      tdEdit.classList.add(\"p-0\")\n      tdEdit.classList.add(\"align-middle\")\n      tdEdit.innerHTML = `\n                <a title=\"${that._options.editText}\" \n                        class=\"btn-open-row btn btn-sm btn btn-primary\"\n                        data-formset-modal-toggle=\"${row.modalForm.modalId}\">\n                        ${that._options.pencilIcon}\n                </a>`;\n      let button = tdEdit.querySelector(\".btn-open-row\");\n\n      button.addEventListener(\"click\", function (e) {\n        row.modalForm.open();\n      });\n\n      tr.appendChild(tdEdit);\n      that._tbody.appendChild(tr);\n\n      if (row.modalForm.isSelected()) {\n        selCheckbox.checked = true;\n        that._checker(tr, tdSel, row.modalForm.targetEl, selCheckbox);\n      }\n\n      rownum++;\n    });\n\n    if (this._tfoot) {\n      this._tfoot\n        .querySelectorAll(\"[data-summary-column]\")\n        .forEach(function (el) {\n          let summary = fields[el.getAttribute(\"data-summary-column\")].summary;\n          el.innerText = summary;\n        });\n    }\n\n    this._checkSelectAllState();\n  }\n}\n\nexport default FormsetModal;\n","import $ from \"jquery\";\nimport Formset, { pluginName } from \"./formset\";\nimport FormsetModal from \"./formset-modal\";\nimport Modal from \"./modal\";\nimport {\n  executeAllCalculatedFields,\n  getModalInstance,\n  hookCalculatedFields,\n  ready,\n  injectStyles,\n} from \"./utils\";\n\nfunction configureFormsets() {\n  let formsets = document.querySelectorAll(\".formset\");\n  formsets.forEach(function (formsetEl) {\n    new FormsetModal(formsetEl.getAttribute(\"id\"));\n  });\n}\n\nfunction configureModals() {\n  let modalInstances = [];\n  document.querySelectorAll(\"[data-modal-toggle]\").forEach((el) => {\n    const modalId = el.getAttribute(\"data-modal-toggle\");\n    const modalEl = document.getElementById(modalId);\n    const placement = modalEl.getAttribute(\"data-modal-placement\");\n\n    if (modalEl) {\n      if (\n        !modalEl.hasAttribute(\"aria-hidden\") &&\n        !modalEl.hasAttribute(\"aria-modal\")\n      ) {\n        modalEl.setAttribute(\"aria-hidden\", \"true\");\n      }\n    }\n\n    let modal = null;\n    if (getModalInstance(modalId, modalInstances)) {\n      modal = getModalInstance(modalId, modalInstances);\n      modal = modal.object;\n    } else {\n      modal = new Modal(modalEl, {\n        placement: placement ? placement : Default.placement,\n      });\n      modalInstances.push({\n        id: modalId,\n        object: modal,\n      });\n    }\n\n    if (\n      modalEl.hasAttribute(\"data-modal-show\") &&\n      modalEl.getAttribute(\"data-modal-show\") === \"true\"\n    ) {\n      modal.show();\n    }\n\n    el.addEventListener(\"click\", () => {\n      modal.toggle();\n    });\n  });\n}\n\n$.fn[pluginName] = function () {\n  var options, fn, args;\n  // Create a new Formset for each element\n  if (\n    arguments.length === 0 ||\n    (arguments.length === 1 && $.type(arguments[0]) != \"string\")\n  ) {\n    options = arguments[0];\n    return this.each(function () {\n      return Formset.getOrCreate(this, options);\n    });\n  }\n\n  // Call a function on each Formset in the selector\n  fn = arguments[0];\n  args = $.makeArray(arguments).slice(1);\n\n  if (fn in Formset) {\n    // Call the Formset class method if it exists\n    args.unshift(this);\n    return Formset[fn].apply(Formset, args);\n  } else {\n    throw new Error(\"Unknown function call \" + fn + \" for $.fn.formset\");\n  }\n};\n\n\nready(function () {\n  injectStyles();\n  configureModals();\n  hookCalculatedFields();\n  configureFormsets();\n  executeAllCalculatedFields();\n});\n"],"names":["gettext","window","_has","Object","prototype","hasOwnProperty","uuidv4","randomHex","Math","floor","random","toString","substring","parseInt","getTextValue","el","textValue","object","key","tagName","toLowerCase","options","selectedIndex","innerText","call","inputmask","undoValue","getAttribute","value","Date","split","toLocaleDateString","checked","executeAllCalculatedFields","calculatedFields","forEach","obj","executeAll","hookCalculatedFields","field","id","document","querySelector","hasAttribute","addEventListener","content","_column","setAttribute","getModalInstance","instances","some","modalInstance","find","django","jsi18n_initialized","msg","pluginName","Formset","constructor","_this","this","opts","$","extend","defaults","$formset","attr","$emptyForm","emptyForm","$body","body","$add","add","formsetPrefix","data","addForm","proxy","click","on","form","$forms","each","i","bindForm","extra","static","rev","hasMaxForms","Error","newIndex","totalFormCount","$managementForm","val","newFormHtml","html","replace","RegExp","$newFormFragment","parseHTML","append","$newForm","filter","newFormCallback","$form","index","prefix","$delete","change","event","is","prop","pattern","removeAttr","trigger","deleteButton","bind","name","length","deletedFormCount","clear","row","not","deleteAll","activeFormCount","openRownum","rownum","maxForms","checkMaxForms","addClass","hasMaxFormsClass","removeClass","animateForms","slideUp","slideDown","bootstrap4SizeClasses","sm","md","lg","xl","templatePacks","bootstrap4","sizes","bootstrap5","modalDefault","placement","size","backdropClasses","templatePack","onHide","onShow","onToggle","Modal","targetEl","_targetEl","_parentEl","parentElement","_options","_isHidden","_init","_addEventListeners","_getPlacementClasses","map","c","classList","_clearSize","_getSizeClasses","firstElementChild","_createBackdrop","backdropEl","createElement","offsetWidth","_destroyBackdropEl","remove","element","that","e","hide","toggle","show","removeAttribute","firstEl","focus","modalFormOptions","parent","modalId","onKeyUp","onClose","onOpen","ModalForm","_modalEl","_modalTitleEl","_modalDeleteBt","_addEvents","getElementById","_createModal","querySelectorAll","close","hasFieldError","fieldId","fieldWrapper","hasError","errorText","error","text","hasNonFieldError","_hiddeDefaultDeleteBt","parentNode","deleteBt","modal","_onModalClose","_onModalShow","tr","closest","openRowBt","isDeleted","isSelected","open","variant","formsetOptions","checkboxClasses","selectionMarkClasses","tdClasses","trClasses","editText","pencilIcon","FormsetModal","elementId","_id","_modalForms","_deleteBt","_table","_tbody","_tfoot","_getVariant","_getTemplatePack","modalSize","_getModalSize","modalPlacement","_getModalPlacement","formset","_emptyState","innerHTML","_checkInitials","_configureSelectAllToggler","_refresh","_getModalFormInstanceByRownum","instance","_onFormsetAdded","_onFormsetDeleted","modals","includes","_newModalForm","push","modalForm","_onModalFormKeyUp","_onModalFormOpen","_onModalFormClose","target","resetCalculatedFields","ctrlKey","keyCode","preventDefault","table","toggler","checkbox","td","formsetFormEl","_checker","selectedForm","deleteCheckbox","dispatchEvent","Event","_checkSelectAllState","showDeleteBt","selectAllToggler","recordCount","selected","indeterminate","prevDivSel","divSel","prepend","fields","fieldNames","rows","type","hasSummary","summary","keys","match","groups","sourceId","a","hasChildNodes","removeChild","lastChild","removeChildren","tdSel","selCheckbox","appendChild","tdNumber","Number","tdEdit","fn","args","arguments","getOrCreate","makeArray","slice","unshift","apply","style","head","modalInstances","modalEl","Default","formsetEl","readyState"],"mappings":"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"}